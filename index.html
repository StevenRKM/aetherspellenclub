<!DOCTYPE html>
<html>
<head>
    <title>Aether Spellenclub</title>
    <script src="jquery-2.0.3.min.js" type="text/javascript"></script>
    <script>

    $(function() {

        console.log('loading data');

        $.ajax({
            url: '/bggapi/xmlapi2/guild?id=1576&members=1',
            contentType: "application/xml; charset=utf-8",
            dataType: "xml"
        }).success(function(data){

            console.log('retrieved data');

            members = $(data).find('member');

            for (i = 0; i < members.length; i++) {
                add_member_collection(members[i].getAttribute('name'));
            }

        }).error(function(data){
            console.log('woops');
        });

    });

    function add_member_collection(member) {

        $.ajax({
            url: '/bggapi/xmlapi2/collection?username='+member+'&own=1',
            contentType: "application/xml; charset=utf-8",
            dataType: "xml"
        }).success(function(data){

            console.log('retrieved data');

            collection = $('<div id='+member+'><h2>'+member+'</h2><br /><div></div></div>');

            items = $(data).find('item')
            for (i = 0; i < items.length; i++) {

                collection.find('div').append(
                        $('<img />', {src: $(items[i]).find('thumbnail').text()})
                );
            }

            collection.hide();
            collection.appendTo('#collections');

            add_member_name(member);

        }).error(function(data){
            console.log('woops');
        });


    }


    function add_member_name(member) {


        $.ajax({
            url: '/bggapi/xmlapi2/user?name='+member,
            contentType: "application/xml; charset=utf-8",
            dataType: "xml"
        }).success(function(data){

            console.log('retrieved data');

            $('#' + member+' h2').text( $(data).find('firstname').attr('value') + ' ' + $(data).find('lastname').attr('value') );
            $('#' + member).show();

        }).error(function(data){
            console.log('woops');

            console.log('display ' + member);
            $('#' + member).show();
        });

    }

    </script>

</head>
<body>

<div id="collections"></div>

<div id="images"></div>

</body>
</html>